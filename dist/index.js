if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=new URL(".",import.meta.url).pathname.slice(import.meta.url.match(/^file:\/\/\/\w:/)?1:0,-1)+"/";var e={};const r=require("@actions/core");const t=require("@actions/tool-cache");const a=require("@actions/github");const n=require("@actions/io");const i=require("@actions/cache");const o=require("@actions/exec");const c=require("@actions/glob");const s=require("semver");const u=require("path");const l=require("os");const h={version:r.getInput("version",{required:true}).replace(/^[vV]/,""),cacheDisabled:r.getBooleanInput("disable-cache"),githubToken:r.getInput("github-token")};async function runAction(){let e;if(h.version.toLowerCase()==="latest"){r.debug("Requesting latest hurl version...");e=await getLatestVersion(h.githubToken)}else{e=h.version}r.startGroup("ğŸ’¾ Install hurl");await doInstall(e);r.endGroup();r.startGroup("ğŸ§ª Installation check");await doCheck();r.endGroup()}async function doInstall(e){const a=u.join(l.tmpdir(),`hurl-${e}`);const o=`hurl-cache-${e}-${process.platform}-${process.arch}`;r.info(`Version to install: ${e} (target directory: ${a})`);let w=undefined;if(!h.cacheDisabled){try{w=await i.restoreCache([a],o)}catch(e){r.warning(e)}}if(w){r.info(`ğŸ‘Œ Hurl restored from cache`)}else{const w=getDistUrl(process.platform,process.arch,e);r.info(`ğŸ“¦ Downloading the distributive: ${w}`);const p=await t.downloadTool(w);const d=u.join(l.tmpdir(),`hurl.tmp`);switch(true){case w.endsWith("tar.gz"):{await t.extractTar(p,d);await n.rmRF(p);const r=u.join(d,s.lt(e,"4.3.0",true)?`hurl-${e}*`:`hurl-${e}*/bin`);const i=await(await c.create(r,{implicitDescendants:false,matchDirectories:true})).glob();if(i.length!==1){throw new Error("Distributive archive contains more than one entry")}await n.mv(i[0],a);break}case w.endsWith("zip"):await t.extractZip(p,a);break;default:throw new Error("Unsupported distributive format")}if(!h.cacheDisabled){try{await i.saveCache([a],o)}catch(e){r.warning(e)}}}r.addPath(a)}async function doCheck(){const e=await n.which("hurl",true);if(e===""){throw new Error("hurl binary file not found in $PATH")}await o.exec("hurl",["--version"],{silent:true});r.setOutput("hurl-bin",e);r.info(`Hurl installed: ${e}`)}async function getLatestVersion(e){const r=a.getOctokit(e);const t=await r.rest.repos.getLatestRelease({owner:"Orange-OpenSource",repo:"hurl"});return t.data.tag_name.replace(/^[vV]/,"")}function getDistUrl(e,r,t){const a=`https://github.com/Orange-OpenSource/hurl/releases/download/${t}/`;const n=s.lt(t,"4.1.0",true);switch(e){case"linux":{switch(r){case"x64":if(n){return`${a}/hurl-${t}-x86_64-linux.tar.gz`}return`${a}/hurl-${t}-x86_64-unknown-linux-gnu.tar.gz`;case"arm64":if(!n){return`${a}/hurl-${t}-aarch64-unknown-linux-gnu.tar.gz`}throw new Error(`Unsupported linux architecture/version (${r}/${t})`)}throw new Error(`Unsupported linux architecture (${r})`)}case"darwin":{switch(r){case"x64":if(n){return`${a}/hurl-${t}-x86_64-macos.tar.gz`}return`${a}/hurl-${t}-x86_64-apple-darwin.tar.gz`;case"arm64":if(n){return`${a}/hurl-${t}-arm64-macos.tar.gz`}return`${a}/hurl-${t}-aarch64-apple-darwin.tar.gz`}throw new Error(`Unsupported macOS architecture (${r})`)}case"win32":{switch(r){case"x64":if(n){return`${a}/hurl-${t}-win64.zip`}return`${a}/hurl-${t}-x86_64-pc-windows-msvc.zip`}throw new Error(`Unsupported windows architecture (${r})`)}}throw new Error(`Unsupported platform (${e})`)}(async()=>{await runAction()})().catch((e=>{r.setFailed(e.message)}));